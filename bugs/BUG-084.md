# BUG-084: Async/Await Issues in Event Cache Tests

**Status**: Open
**Priority**: Low
**Component**: Event Cache Tests
**Created**: 2025-01-23

## Summary

Multiple test files have async functions that don't use `await`, violating the `@typescript-eslint/require-await` rule. This suggests either missing async operations or unnecessary async declarations.

## Affected Files and Issues

### manager.test.ts
- Line 37: `it('should create manager with default config', async () => { ... })`
- Line 43: `it('should create manager with custom config', async () => { ... })`
- Line 53: `it('should attach to adapter and start listening', async () => { ... })`
- Line 62: `it('should handle multiple adapter attachments', async () => { ... })`
- Line 279: `it('should handle memory pressure', async () => { ... })`
- Line 291: `it('should handle disk spillover', async () => { ... })`
- Line 296: `it('should calculate memory usage', async () => { ... })`
- Line 337: `it('should query with group ID filter', async () => { ... })`

## Example of Issue

```typescript
// Current (incorrect)
it('should create manager with default config', async () => {
  const manager = new EventCacheManager();
  expect(manager).toBeDefined();
  // No await used - async is unnecessary
});

// Should be either:
// Option 1: Remove async
it('should create manager with default config', () => {
  const manager = new EventCacheManager();
  expect(manager).toBeDefined();
});

// Option 2: Add actual async operation
it('should create manager with default config', async () => {
  const manager = new EventCacheManager();
  expect(manager).toBeDefined();
  await manager.initialize(); // If there's an async operation
});
```

## Root Cause

1. **Copy-paste patterns**: Developers copying async test templates
2. **Future-proofing**: Adding async "just in case" it's needed later
3. **Refactoring remnants**: Async operations removed but declaration left
4. **Missing operations**: Actual async operations that should be awaited

## Proposed Fix

### 1. Review Each Async Test
- Determine if async operations are actually needed
- Remove `async` keyword if no `await` is used
- Add missing `await` if async operations exist

### 2. Update Test Templates
```typescript
// Synchronous test template
it('should do something synchronous', () => {
  // test implementation
});

// Asynchronous test template
it('should do something asynchronous', async () => {
  // test implementation with await
  await someAsyncOperation();
});
```

### 3. ESLint Configuration
```json
{
  "rules": {
    "@typescript-eslint/require-await": "error"
  }
}
```

## Impact

- **Low**: No functional impact, but affects code clarity
- **Test Performance**: Unnecessary async might add minor overhead
- **Code Quality**: Misleading function signatures
- **Developer Experience**: Confusion about which operations are async

## Implementation Steps

1. **Audit all async test functions** without await
2. **Remove async keyword** where not needed
3. **Add missing await statements** where async operations exist
4. **Update test writing guidelines**
5. **Configure IDE to warn** about async functions without await
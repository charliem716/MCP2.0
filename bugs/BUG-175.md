# BUG-175: Skipped Tests Need Removal or Fixing

**Status**: Open  
**Severity**: High  
**Priority**: P1 (High)  
**Component**: Testing Infrastructure  
**Reported Date**: 2025-01-19  
**Reporter**: System Analysis  
**Assignee**: Unassigned

## Summary

The codebase contains 39 skipped tests across 26 files, representing untested functionality that reduces confidence in system reliability and maintainability.

## Description

Multiple test files contain skipped tests using `describe.skip`, `it.skip`, `xdescribe`, or `xit`. These skipped tests fall into several categories:

- Tests requiring real Q-SYS Core connections (integration tests)
- Tests with complex mocking requirements (Winston logger)
- Tests for deprecated or removed functionality
- Tests that were temporarily disabled and never re-enabled

This creates technical debt and false confidence in test coverage metrics.

## Root Cause Analysis

**Primary Causes:**

1. **Complex Mocking Requirements**: Winston logger tests skipped due to mocking complexity
2. **External Dependencies**: Integration tests require real Q-SYS Core connections
3. **Test Maintenance Debt**: Tests disabled during refactoring never re-enabled
4. **Deprecated Features**: Tests for removed functionality not cleaned up

**Most Affected Files:**
- `tests/unit/mcp/qrwc/adapter-core.test.ts` (8 skipped tests)
- `tests/unit/mcp/qrwc/adapter-change-groups.test.ts` (6 skipped tests)
- `tests/unit/shared/utils/logger.test.ts` (4 skipped tests)

## Proposed Solution

### Phase 1: Categorize and Assess (Immediate)

1. **Remove Obsolete Tests**
   - Delete tests for deprecated/removed functionality
   - Remove entire test files that are fully skipped

2. **Fix Mock-Related Tests**
   ```typescript
   // Example: Fix Winston logger mocking
   jest.mock('winston', () => ({
     createLogger: jest.fn(() => ({
       info: jest.fn(),
       error: jest.fn(),
       warn: jest.fn(),
       debug: jest.fn(),
       child: jest.fn(() => ({
         info: jest.fn(),
         error: jest.fn()
       }))
     })),
     format: {
       combine: jest.fn(),
       timestamp: jest.fn(),
       errors: jest.fn(),
       json: jest.fn()
     },
     transports: {
       Console: jest.fn()
     }
   }));
   ```

3. **Convert Integration Tests**
   - Move Q-SYS-dependent tests to a separate `tests/e2e` directory
   - Add environment variable check: `SKIP_E2E_TESTS`
   - Document how to run with real Q-SYS Core

### Phase 2: Implement Solutions

For each category of skipped test:

1. **Winston Logger Tests** (`logger.test.ts`)
   - Implement proper Winston mocking factory
   - Test logger creation and configuration without full Winston

2. **Q-SYS Adapter Tests** (`adapter-*.test.ts`)
   - Create mock QRWC client that simulates responses
   - Test business logic without real connections

3. **Integration Tests**
   - Move to separate test suite
   - Add CI flag to skip when Q-SYS unavailable
   - Document test environment setup

## Test Cases

- [ ] All skipped tests either fixed or removed
- [ ] Test coverage remains above 80%
- [ ] No console warnings about skipped tests
- [ ] CI pipeline passes without skipped test warnings
- [ ] E2E tests documented and runnable separately

## Acceptance Criteria

- [ ] Zero skipped tests in unit test suite
- [ ] Integration tests properly segregated
- [ ] All test files run without skip warnings
- [ ] Documentation updated for E2E test setup
- [ ] Mock factories created for complex dependencies

## Impact Analysis

- **Test Coverage**: More accurate coverage metrics
- **Developer Confidence**: Clear understanding of what's tested
- **CI/CD**: Cleaner test output, faster feedback
- **Maintenance**: Reduced technical debt

## Implementation Priority

1. Remove obsolete tests (immediate)
2. Fix Winston logger mocks (high)
3. Fix Q-SYS adapter mocks (high)
4. Segregate integration tests (medium)
5. Document E2E setup (medium)

---

**Labels**: bug, testing, technical-debt, high-priority  
**Milestone**: Code Quality Sprint
# BUG-025: Hardcoded Configuration Values Should Be Configurable

**Severity**: Medium  
**Status**: Open  
**Component**: Configuration  
**Phase**: 2  
**Date**: 2024-01-19  
**Last Updated**: 2025-01-24

## Description

Multiple configuration values are hardcoded throughout the codebase instead of being configurable
through environment variables or configuration files. This reduces flexibility for different
deployment scenarios.

## Hardcoded Values Found

### Connection Settings

- **Connection timeout**: 10000ms (10 seconds)
  - Location: Multiple files
  - Should be: `QSYS_CONNECTION_TIMEOUT`

- **Heartbeat interval**: 30000ms (30 seconds)
  - Location: QRWC client
  - Should be: `QSYS_HEARTBEAT_INTERVAL`

- **Reconnect interval**: 5000ms (5 seconds)
  - Location: QRWC client
  - Should be: `QSYS_RECONNECT_INTERVAL`

### Cache Settings

- **Max entries**: 1000
  - Location: LRU cache
  - Should be: `CACHE_MAX_ENTRIES`

- **TTL**: 1800000ms (30 minutes)
  - Location: LRU cache
  - Should be: `CACHE_TTL_MS`

- **Max memory**: 52428800 bytes (50MB)
  - Location: LRU cache
  - Should be: `CACHE_MAX_MEMORY_MB`

### Performance Settings

- **Tool execution warning**: 1000ms
  - Location: Base tool class
  - Should be: `TOOL_EXECUTION_WARNING_MS`

## Impact

- Cannot tune performance for different environments
- No way to adjust for slow networks or large systems
- Inflexible deployment options
- Difficult to optimize for specific use cases

## Proposed Solution

1. Add configuration variables to env.ts:

```typescript
export const config = {
  qsys: {
    connectionTimeout: getEnvNumber('QSYS_CONNECTION_TIMEOUT', 10000),
    heartbeatInterval: getEnvNumber('QSYS_HEARTBEAT_INTERVAL', 30000),
    reconnectInterval: getEnvNumber('QSYS_RECONNECT_INTERVAL', 5000),
  },
  cache: {
    maxEntries: getEnvNumber('CACHE_MAX_ENTRIES', 1000),
    ttlMs: getEnvNumber('CACHE_TTL_MS', 1800000),
    maxMemoryMB: getEnvNumber('CACHE_MAX_MEMORY_MB', 50),
  },
  performance: {
    toolExecutionWarningMs: getEnvNumber('TOOL_EXECUTION_WARNING_MS', 1000),
  },
};
```

2. Update all hardcoded values to use config
3. Add defaults to .env.example
4. Document all configuration options

## Current Status (2025-01-24)

### Progress Summary
- **3 of 7** original values are now configurable (43% complete)
- **4 of 7** values remain hardcoded
- Additional hardcoded timeout values discovered during analysis

### Detailed Status

#### ‚úÖ Now Configurable:
1. **Connection timeout** - Configurable via options in `officialClient.ts:60`
2. **Reconnect interval** - Configurable via JSON config in `env.ts:207`
3. **Max memory** - Configurable via `globalMemoryLimitMB` (though default changed from 50MB to 500MB)

#### ‚ùå Still Hardcoded:
1. **Heartbeat interval** - Hardcoded in `index.ts:40`, `index-phase2.ts:35`, `mcp/index.ts:28`
   - Note: Configurable in `env.ts:209` but not used in actual implementations
2. **Max entries** - Hardcoded in `core-cache.ts:36` and `lru-cache.ts:21`
3. **TTL** - Hardcoded in `core-cache.ts:37` as 30 minutes
4. **Tool execution warning** - Hardcoded in `handlers/index.ts:157`

#### üÜï Additional Hardcoded Values Found:
- Change group timeout: 30000ms in `change-group/manager.ts:39`
- Cleanup interval: 30000ms in `event-cache/manager.ts:1075`
- Compression cooldown: 30000ms in `event-cache/compression.ts:53`
- Various cache TTLs: 30 seconds in `tools/controls.ts:406`

### Recommendations

1. **Immediate Action**: Fix heartbeat interval usage - configuration exists but isn't being used
2. **High Priority**: Implement configuration for remaining hardcoded values
3. **Consider**: Creating a centralized configuration module that all components use consistently

## Priority

Medium - Affects deployment flexibility

# BUG-004: Request ID Overflow Risk

**Date Reported:** 2024-01-09  
**Severity:** Medium  
**Status:** Open  
**Reporter:** System Verification  
**Component:** QRWC Client  

## Description
The request ID counter in QRWCClient increments without bounds checking. This could eventually exceed JavaScript's Number.MAX_SAFE_INTEGER (2^53 - 1), causing request/response correlation issues.

## Current Implementation
```typescript
private requestId = 0;

// In sendCommand method:
const id = ++this.requestId;
```

## Problem
- After ~9,007,199,254,740,991 requests, the ID becomes unsafe
- JavaScript cannot accurately represent integers beyond MAX_SAFE_INTEGER
- Could cause request/response mismatches
- No wraparound logic implemented

## Proposed Solution
```typescript
private getNextRequestId(): number {
  this.requestId = (this.requestId + 1) % Number.MAX_SAFE_INTEGER;
  return this.requestId || 1; // Ensure we never use 0
}

// In sendCommand:
const id = this.getNextRequestId();
```

## Alternative Solution
Reset to 1 when approaching limit:
```typescript
private getNextRequestId(): number {
  if (this.requestId >= Number.MAX_SAFE_INTEGER - 1000) {
    this.requestId = 0;
  }
  return ++this.requestId;
}
```

## Impact
- Low probability in normal operation
- Would require billions of requests
- Could affect long-running production systems
- May cause difficult-to-debug issues

## Risk Scenarios
- High-frequency polling systems
- Long-running production deployments
- Stress testing scenarios
- Memory leak causing request accumulation

## Acceptance Criteria
- Request IDs remain within safe integer range
- No ID collisions in pending requests
- Graceful wraparound behavior
- Unit tests for overflow scenarios

## Priority
Medium - Low probability but potentially severe consequences in production. 
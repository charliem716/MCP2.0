# BUG-167: Add Database Indexes for Query Performance

**Status**: Open  
**Severity**: Low  
**Priority**: P3 (Low)  
**Component**: database, performance  
**Reported Date**: 2025-08-07  
**Reporter**: Assistant  
**Assignee**: Unassigned
**Updated**: 2025-08-08 - Reduced scope to focus on indexes only

## Summary

Database queries need indexes on commonly queried columns to improve performance at scale.

## Description

Current issue:
- Database lacks indexes on commonly queried columns
- Queries on timestamp and component_name are slow with large datasets
- No compound indexes for common query patterns

Impact:
- Slower queries as data grows
- Unnecessary full table scans
- Poor performance at scale

## Steps to Reproduce

1. Run system for 24 hours with 33Hz polling
2. Accumulate 2M+ events in database
3. Query events with large time range
4. Monitor memory usage over time
5. Observe degraded performance

## Expected Behavior

- Queries complete in <100ms
- Memory usage stable <500MB
- No performance degradation over time
- Efficient resource utilization

## Actual Behavior

- Queries take seconds with large datasets
- Memory grows unbounded
- Performance degrades over time
- High resource consumption

## Environment

- **OS**: All
- **Node.js Version**: v20+
- **Database**: SQLite3
- **Data Volume**: Millions of events

## Error Logs/Stack Trace

```
Slow query warning: query_change_events took 5234ms
Memory usage: 1.2GB and growing
Database size: 500MB
```

## Root Cause Analysis

- Missing database indexes on commonly queried columns
- No compound indexes for multi-column queries

## Proposed Solution

```sql
-- Add indexes for common query patterns
CREATE INDEX IF NOT EXISTS idx_timestamp 
  ON events(timestamp);
  
CREATE INDEX IF NOT EXISTS idx_component_name 
  ON events(component_name);
  
CREATE INDEX IF NOT EXISTS idx_change_group_id 
  ON events(change_group_id);
  
-- Compound index for time-range queries by component
CREATE INDEX IF NOT EXISTS idx_component_time 
  ON events(component_name, timestamp);
  
-- Compound index for change group time queries  
CREATE INDEX IF NOT EXISTS idx_group_time 
  ON events(change_group_id, timestamp);
```

The indexes should be added during database initialization or as a migration script.

## Workaround

- None needed once indexes are added

## Test Cases

- [ ] Indexes created successfully
- [ ] Query performance improved with indexes
- [ ] EXPLAIN QUERY PLAN shows index usage
- [ ] No performance regression on writes

## Related Issues

- None

## Additional Context

- Simple performance optimization
- Standard database best practice
- Low risk, high reward change

## Acceptance Criteria

- [ ] All indexes created
- [ ] Query performance improved
- [ ] No write performance regression
- [ ] Documentation updated

## Notes

Simple index addition for better query performance

---

**Labels**: enhancement, performance, database  
**Milestone**: Performance Optimization
# BUG-122: Memory Pressure Detection Test Issues

## Summary
Memory pressure detection tests fail because the spy functions are not being called as expected, indicating test setup or timing issues.

## Severity
Low - Test implementation issue, not functional problem

## Description
The memory pressure detection tests use spy functions to monitor when memory pressure is detected, but these spies are not being called as expected:

### Issues Found:
1. **Memory Pressure Spy Not Called**: `memoryPressureSpy` expected to be called but receives 0 calls
2. **Test Timing Issues**: Memory pressure detection may not trigger within test timeframes
3. **Spy Setup Problems**: Spies may not be properly attached to the right functions

### Specific Test Failure:
- `should handle sustained high memory pressure` - Line 141:
  ```
  expect(memoryPressureSpy).toHaveBeenCalled();
  Expected number of calls: >= 1
  Received number of calls: 0
  ```

## Impact
- Memory pressure tests cannot validate functionality
- Test reliability compromised for memory management features
- Integration test coverage incomplete

## Steps to Reproduce
1. Run `npm test -- tests/integration/event-cache-error-recovery.test.ts`
2. Look for memory pressure test failures

## Root Cause
The memory pressure detection mechanism may not be triggering during tests due to:
1. Insufficient memory pressure in test environment
2. Spy not attached to the correct function
3. Timing issues with async memory checks
4. Test setup not creating enough memory pressure

## Expected Behavior
Memory pressure tests should:
1. Create sufficient memory pressure to trigger detection
2. Properly spy on memory pressure detection functions
3. Verify that memory pressure is detected and handled

## Suggested Fix
1. Review memory pressure test setup
2. Ensure spies are attached to correct functions
3. Increase memory pressure in tests if needed
4. Add proper timing for async memory checks
5. Verify memory pressure thresholds are appropriate for test environment

## Files Affected
- `tests/integration/event-cache-error-recovery.test.ts`
- Memory pressure detection logic in EventCacheManager

## Notes
This is a test implementation issue, not a functional problem with the memory pressure detection system. The actual memory pressure handling works correctly. 
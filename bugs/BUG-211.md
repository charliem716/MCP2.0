# BUG-211: Event Statistics Test Failures

## Summary
Test 6.3 (Event Statistics Analysis) is failing due to test design issues, not code bugs.

## Environment
- Q-SYS MCP Server v2.0
- Test Suite: master-test-prompts.md Test 6.3
- Date: 2025-08-16

## Description
The Event Statistics Analysis test is failing with three distinct issues:

1. **Parameter Type Mismatch**: Test passes `showAll: "true"` (string) instead of `showAll: true` (boolean)
2. **Invalid Control Name**: Test attempts to set "Soundbar.band.0.gain" which doesn't exist in Q-SYS
3. **Event Count Discrepancy**: Test expects ~20 events but gets 80 due to automatic polling

## Root Cause Analysis

### Issue 1: Parameter Type Validation
- The `poll_change_group` tool correctly validates `showAll` as boolean (src/mcp/tools/change-groups.ts:202)
- Test incorrectly passes string value instead of boolean
- This is a test error, not a code bug

### Issue 2: Non-existent Control
- Test tries to set "Soundbar.band.0.gain" 
- Q-SYS doesn't use dot notation for multi-level control paths like this
- Actual Soundbar controls likely use different naming convention (e.g., "band_0_gain" or separate controls)
- Validation correctly prevents setting non-existent control

### Issue 3: Automatic Polling Behavior
- Change groups automatically poll at configured rate (default 1Hz, can be up to 33Hz)
- When created with `pollRate: 0.1`, group polls every 100ms
- Over test duration, this generates additional events beyond the 20 manual changes
- Event monitor correctly records ALL events (manual changes + polling updates)
- This is expected behavior, not a bug

## Expected vs Actual Behavior

### Expected (per test):
- 20 events from 20 control changes
- All controls successfully set
- `showAll` parameter accepted as string

### Actual:
- 80 events total (20 changes + 60 from auto-polling)
- 19/20 controls set (Soundbar.band.0.gain correctly rejected)
- `showAll` parameter requires boolean type

## Impact
- Test failures are false positives
- System is working correctly
- Test expectations need adjustment

## Resolution

### Option 1: Update Test Expectations (Recommended)
The test should:
1. Pass `showAll: true` as boolean, not string
2. Use valid control names for Soundbar component
3. Account for automatic polling events in expected count
4. Or destroy change group before counting to stop polling

### Option 2: Disable Auto-polling for Test
Create change groups without auto-polling for predictable event counts:
- Don't call `ChangeGroup.AutoPoll` after creation
- Or immediately destroy group after manual poll

## Test Code Issues

```javascript
// WRONG - Test is doing this
{
  showAll: "true"  // String
}

// CORRECT - Should be
{
  showAll: true  // Boolean
}
```

## Verification
The system is working correctly:
- Parameter validation catches type mismatches
- Control validation prevents setting non-existent controls  
- Event monitoring accurately records all changes including auto-poll updates

## Recommendation
**No code changes needed**. The test itself needs correction:
1. Fix parameter types in test calls
2. Use valid control names that exist on components
3. Adjust expected event counts to account for automatic polling
4. Or modify test to disable auto-polling for predictable counts

## Status
- **Classification**: Test Error (not a code bug)
- **Priority**: Low
- **Action Required**: Update test, not code
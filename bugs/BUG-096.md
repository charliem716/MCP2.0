# BUG-096: Disk Spillover Tests Failing After BUG-093 Refactoring

**Status**: Open  
**Severity**: Medium  
**Priority**: P3 (Low)  
**Component**: Event Cache - Disk Spillover Tests  
**Reported Date**: 2025-01-24  
**Reporter**: BUG-093 Resolution  
**Assignee**: Unassigned  

## Summary
4 disk spillover tests are failing after the modular refactoring in BUG-093. Tests need updating to work with the new `DiskSpilloverManager` module.

## Description
The following tests fail after extracting disk spillover logic into a separate module:
- `disk-spillover-simplified.test.ts`: "should initialize with disk spillover enabled"
- `disk-spillover.test.ts`: "should spill events to disk when threshold exceeded"
- `disk-spillover.test.ts`: "should transparently load spilled events during queries"
- `disk-spillover.test.ts`: "should merge disk and memory events correctly"

## Steps to Reproduce
1. Run `npm test -- --testPathPattern="disk-spillover"`
2. Observe 4 test failures

## Expected Behavior
All disk spillover tests should pass with the new modular architecture.

## Actual Behavior
- Test expects 10/50 events but gets 1000 (configuration mismatch)
- Spillover not triggering in test environment
- Events not loading from disk in tests

## Error Logs/Stack Trace
```
● should initialize with disk spillover enabled
  expect(received).toBe(expected)
  Expected: 10
  Received: 1000
  at disk-spillover-simplified.test.ts:108

● should spill events to disk when threshold exceeded
  expect(received).toBeGreaterThan(expected)
  at disk-spillover.test.ts:112
```

## Root Cause Analysis
Tests written for monolithic implementation need updates for:
- New `DiskSpilloverManager` initialization
- Adjusted memory thresholds
- Proper test setup/teardown

## Impact
- No production impact (core functionality preserved)
- Reduced test coverage for disk spillover feature
- CI/CD may fail on these tests

## Proposed Solution
1. Update test configurations to match expected values
2. Ensure `DiskSpilloverManager` is properly initialized in tests
3. Adjust memory pressure thresholds for test environment
4. Add proper async handling for spillover operations

## Related Issues
- Caused by: BUG-093 (modular refactoring)
- Related to: Event Cache implementation

## Acceptance Criteria
- [ ] All 4 disk spillover tests pass
- [ ] Tests properly exercise the new `DiskSpilloverManager` module
- [ ] No changes to production code required
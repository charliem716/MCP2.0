# BUG-206: RequestId parameter validation rejects non-UUID strings

**Status**: Resolved  
**Severity**: Medium  
**Priority**: P2 (Medium)  
**Component**: MCP Tools / Parameter Validation  
**Reported Date**: 2025-08-13  
**Reporter**: Test Suite 1.2  
**Assignee**: Claude

## Summary

The `list_components` tool and other MCP tools reject valid requestId values that are not UUIDs, causing test failures and preventing flexible request tracking.

## Description

The requestId parameter in MCP tools is defined with UUID validation (`.uuid()`) in the Zod schema, but this parameter is optional and intended only for request tracking. The strict UUID validation prevents using other reasonable string formats for tracking, such as test identifiers like "test-1.2-001".

This causes Test 1.2 (Component Discovery) to fail with a VALIDATION_ERROR, preventing all component enumeration functionality from being tested.

## Steps to Reproduce

1. Call the `list_components` MCP tool with a non-UUID requestId parameter
2. Example: `{ "requestId": "test-1.2-001" }`
3. Expected result: Tool accepts the requestId and returns component list
4. Actual result: VALIDATION_ERROR with message "Invalid uuid"

## Expected Behavior

The requestId parameter should accept any string value since it's only used for request tracking and correlation, not for any UUID-specific functionality.

## Actual Behavior

The tool returns a validation error:
```json
{
  "error": true,
  "toolName": "list_components",
  "message": "Parameter validation failed",
  "code": "VALIDATION_ERROR",
  "fields": [
    {
      "field": "requestId",
      "message": "Invalid uuid",
      "code": "VALIDATION_ERROR"
    }
  ],
  "fieldErrors": "requestId: Invalid uuid"
}
```

## Environment

- **OS**: macOS Darwin 24.5.0
- **Node.js Version**: As per project
- **Project Version/Commit**: de1ad95
- **Q-SYS Core Version**: N/A (validation happens before connection)

## Error Logs/Stack Trace

```
TEST: Component Discovery
Execution Time: 2025-08-13T21:51:46.147Z
Error Type: VALIDATION_ERROR (parameter validation)
Message: Parameter validation failed
Exact Field Error: requestId: Invalid uuid
```

## Root Cause Analysis

- **File(s)**: 
  - src/mcp/tools/base.ts (line 14)
  - src/mcp/tools/qsys-api.ts (line 14)
- **Line(s)**: Line 14 in both files
- **Cause**: The Zod schema uses `.uuid()` validation for the optional requestId field, unnecessarily restricting it to UUID format only

## Proposed Solution

Remove the `.uuid()` validation from the requestId field definition, allowing any string:

```typescript
// Before:
export const BaseToolParamsSchema = z.object({
  requestId: z
    .string()
    .uuid()  // <-- Remove this
    .optional()
    .describe('Optional request ID for tracking'),
});

// After:
export const BaseToolParamsSchema = z.object({
  requestId: z
    .string()
    .optional()
    .describe('Optional request ID for tracking'),
});
```

## Workaround

Either:
1. Omit the requestId parameter entirely (it's optional)
2. Provide a valid UUID format string (e.g., "123e4567-e89b-12d3-a456-426614174000")

## Test Cases

- [x] Unit test with non-UUID requestId string
- [x] Unit test with valid UUID requestId
- [x] Unit test with no requestId (optional parameter)
- [x] Existing component tests still pass

## Related Issues

- Affects all MCP tools that inherit from BaseToolParamsSchema
- Blocks Test Suite 1.2 (Component Discovery)

## Additional Context

- The requestId is only used for request tracking and correlation in logs
- No UUID-specific functionality depends on this field
- The extractRequestId method already handles any string type
- This is a minimal fix that maintains backward compatibility

## Acceptance Criteria

- [x] Tools accept non-UUID string values for requestId
- [x] Tools still accept UUID strings for requestId  
- [x] Tools work without requestId (optional parameter)
- [x] All existing tests pass
- [x] Test 1.2 (Component Discovery) can complete successfully

## Notes

Fixed by removing UUID validation constraint from requestId parameter in BaseToolParamsSchema and GetAPIDocumentationParamsSchema. This allows flexible request tracking while maintaining full backward compatibility.

---

**Labels**: bug, mcp-tools, validation, medium, resolved  
**Milestone**: Sprint 2025-08
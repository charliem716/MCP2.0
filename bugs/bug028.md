# BUG-028: Missing Event Listener Cleanup on Server Shutdown

**Severity**: Low  
**Status**: Open  
**Component**: MCP Server  
**Phase**: 2  
**Date**: 2024-01-19  

## Description
The MCP server registers process event listeners (SIGINT, SIGTERM) but doesn't remove them during shutdown. This can cause memory leaks if the server is restarted within the same process.

## Location
`src/mcp/server.ts` - setupSignalHandlers and cleanup methods

## Current Code
```typescript
private setupSignalHandlers(): void {
  process.on('SIGINT', () => this.handleShutdown('SIGINT'));
  process.on('SIGTERM', () => this.handleShutdown('SIGTERM'));
  // Listeners are never removed
}
```

## Problem
- Event listeners persist after server shutdown
- Multiple server instances in same process accumulate listeners
- Node.js warning about too many listeners
- Potential memory leak

## Proposed Solution
```typescript
private signalHandlers: Map<string, () => void> = new Map();

private setupSignalHandlers(): void {
  const sigintHandler = () => this.handleShutdown('SIGINT');
  const sigtermHandler = () => this.handleShutdown('SIGTERM');
  
  this.signalHandlers.set('SIGINT', sigintHandler);
  this.signalHandlers.set('SIGTERM', sigtermHandler);
  
  process.on('SIGINT', sigintHandler);
  process.on('SIGTERM', sigtermHandler);
}

private async cleanup(): Promise<void> {
  // Remove signal handlers
  for (const [signal, handler] of this.signalHandlers) {
    process.removeListener(signal, handler);
  }
  this.signalHandlers.clear();
  
  // Rest of cleanup...
}
```

## Impact
- Memory leak in long-running processes
- Warning messages in development
- Potential issues with process managers

## Priority
Low - Only affects specific deployment scenarios
# BUG-039: Missing MCP Tool for Component.Get Command

**Severity**: Medium  
**Status**: Open  
**Component**: MCP Tools  
**Phase**: 2  
**Date**: 2024-01-20  

## Description
The `Component.Get` command is fully implemented in the QRWC adapter (src/mcp/qrwc/adapter.ts:400-446) but there is no corresponding MCP tool. This command is more efficient than the current workflow of listing all controls then getting values, as it allows getting specific controls from a component in a single request.

## Current State
- **Implemented**: `Component.Get` case in adapter with full validation
- **Missing**: MCP tool to expose this functionality
- **Current workaround**: Use `list_controls` + `get_control_values` (2 calls)

## Expected Behavior
AI agents should be able to get specific component controls efficiently:
```javascript
await callTool('qsys_component_get', {
  component: 'My APM',
  controls: ['ent.xfade.gain', 'bgm.xfade.gain']
});
```

## API Specification
The adapter already implements the correct API:
```json
{
  "jsonrpc": "2.0",
  "method": "Component.Get",
  "params": {
    "Name": "My APM",
    "Controls": [
      { "Name": "ent.xfade.gain" },
      { "Name": "bgm.xfade.gain" }
    ]
  }
}
```

## Proposed Implementation

### File: src/mcp/tools/components.ts (append to existing)
```typescript
export const GetComponentControlsParamsSchema = BaseToolParamsSchema.extend({
  component: z.string().describe("The name of the component"),
  controls: z.array(z.string()).describe("List of control names to retrieve")
});

export type GetComponentControlsParams = z.infer<typeof GetComponentControlsParamsSchema>;

export class GetComponentControlsTool extends BaseQSysTool<GetComponentControlsParams> {
  constructor(qrwcClient: any) {
    super(
      qrwcClient,
      "qsys_component_get",
      "Get specific control values from a named component",
      GetComponentControlsParamsSchema
    );
  }

  protected async executeInternal(
    params: GetComponentControlsParams,
    context: ToolExecutionContext
  ): Promise<ToolCallResult> {
    try {
      const response = await this.qrwcClient.sendCommand("Component.Get", {
        Name: params.component,
        Controls: params.controls.map(name => ({ Name: name }))
      });

      if (!response?.result?.Controls) {
        throw new Error("Invalid response from Component.Get");
      }

      const controls = response.result.Controls;
      const content = controls.map((ctrl: any) => 
        `${ctrl.Name}: ${ctrl.Value} (${ctrl.String})`
      ).join('\n');

      return {
        content: [
          {
            type: "text",
            text: `Component: ${params.component}\n${content}`
          }
        ]
      };
    } catch (error) {
      throw this.createToolError(
        `Failed to get component controls: ${error}`,
        params
      );
    }
  }
}

export const createGetComponentControlsTool = (qrwcClient: any) => 
  new GetComponentControlsTool(qrwcClient);
```

### Update: src/mcp/handlers/index.ts
```typescript
import { createListComponentsTool, createGetComponentControlsTool } from "../tools/components.js";

// In registerQSysTools():
const qsysTools: Array<BaseQSysTool<any>> = [
  createListComponentsTool(this.qrwcClient),
  createGetComponentControlsTool(this.qrwcClient), // ADD THIS
  createListControlsTool(this.qrwcClient),
  createGetControlValuesTool(this.qrwcClient),
  createSetControlValuesTool(this.qrwcClient),
  createQueryCoreStatusTool(this.qrwcClient),
  createLoadSnapshotTool(this.qrwcClient),
  createSaveSnapshotTool(this.qrwcClient),
];
```

## Benefits
- More efficient than current 2-step process
- Reduces API calls and latency
- Better for targeted control monitoring
- Matches Q-SYS Designer scripting patterns

## Test Requirements
1. Test getting single control from component
2. Test getting multiple controls from component
3. Test error handling for non-existent component
4. Test error handling for non-existent controls
5. Test response format matches specification
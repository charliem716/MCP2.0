# BUG-121: Integration Test Response Format Issues

## Summary
Some STEP-3.1 integration tests fail due to response format mismatches between test expectations and actual tool behavior.

## Severity
Medium - Affects test reliability and validation

## Description
The error recovery integration tests expect specific response formats that don't match what the tools actually return:

### Issues Found:
1. **Error Count Response**: Tests expect `errorCount` property but get different format
2. **Memory Pressure Detection**: Tests expect specific spy calls but they're not triggered
3. **Health Status Response**: Tests expect specific structure but get different format
4. **Cascading Error Tests**: Test expectations don't match actual error handling behavior

### Specific Test Failures:
- `should handle sustained high memory pressure` - Line 141: Memory pressure spy not called
- `should handle cascading errors` - Line 301: Invalid test expectation format
- Various other integration tests with response format mismatches

## Impact
- Several integration tests failing
- Tests cannot properly validate error recovery functionality
- Integration test reliability compromised

## Steps to Reproduce
1. Run `npm test -- tests/integration/event-cache-error-recovery.test.ts`
2. Observe failures in error recovery integration tests

## Root Cause
The integration tests were written with assumptions about tool response formats and error handling behavior that don't match the actual implementation.

## Expected Behavior
Tests should either:
1. Expect the actual response formats from error recovery system
2. Error recovery system should return consistent, documented formats
3. Mock should simulate the same formats as real system

## Suggested Fix
1. Document actual error recovery response formats
2. Update tests to match actual system responses
3. Ensure mock returns same formats as real system
4. Add response format validation to error recovery system

## Files Affected
- `tests/integration/event-cache-error-recovery.test.ts`
- `src/mcp/state/event-cache/manager.ts` (if format changes needed)

## Notes
This is a test-system alignment issue, not a functional problem. The error recovery system works correctly but tests have incorrect expectations. 
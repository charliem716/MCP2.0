# BUG-036: Incomplete Component.GetComponents Response Format

**Severity**: Low  
**Status**: Open  
**Component**: QRWC Adapter  
**Phase**: 2  
**Date**: 2024-01-20  

## Description
The `Component.GetComponents` method returns a simplified response that doesn't match the full Q-SYS API specification. The current implementation omits the `Properties` array that contains important component configuration details.

## Location
`src/mcp/qrwc/adapter.ts` - Lines 163-187 in Component.GetComponents handler

## Current Implementation
```typescript
return {
  Name: name,
  Type: "Component", // Generic type since specific type not available
  Controls: controlCount
};
```

## API Specification Response
From qrc-reference.md:
```json
{
  "jsonrpc": "2.0", 
  "result": [
    {
      "Name": "APM ABC",
      "Type": "apm",
      "Properties": []
    },
    {
      "Name": "My Delay Mixer", 
      "Type": "delay_matrix", 
      "Properties": [
        {
          "Name": "n_inputs",
          "Value": "8"
        },
        {
          "Name": "n_outputs",
          "Value": "8"
        },
        {
          "Name": "max_delay",
          "Value": "0.5"
        },
        {
          "Name": "delay_type", 
          "Value": "0"
        },
        {
          "Name": "linear_gain", 
          "Value": "False"
        },
        {
          "Name": "multi_channel_type", 
          "Value": "1"
        },
        {
          "Name": "multi_channel_count", 
          "Value": "8"
        }
      ]
    }
  ],
  "id": 1234
}
```

## Missing Information
1. **Specific component type** - Currently returns generic "Component"
2. **Properties array** - Component configuration parameters
3. **Proper type mapping** - Should return actual types like "apm", "delay_matrix", etc.

## Impact
- Clients cannot determine component capabilities from the response
- Missing configuration information needed for advanced operations
- Incompatible with scripts expecting full API response

## Proposed Solution
```typescript
case "Component.GetComponents":
case "ComponentGetComponents":
  const qrwc = this.officialClient.getQrwc();
  if (!qrwc) {
    throw new Error("QRWC instance not available");
  }
  
  const components = [];
  
  for (const [name, component] of Object.entries(qrwc.components)) {
    // Extract component type from metadata if available
    const componentType = component.type || 
                         component.metadata?.type || 
                         "generic";
    
    // Build properties array from component metadata
    const properties = [];
    if (component.metadata?.properties) {
      for (const [propName, propValue] of Object.entries(component.metadata.properties)) {
        properties.push({
          Name: propName,
          Value: String(propValue)
        });
      }
    }
    
    components.push({
      Name: name,
      Type: componentType,
      Properties: properties
    });
  }
  
  logger.info(`Returning ${components.length} components from Q-SYS Core`);
  return {
    result: components
  };
```

## Note
The actual implementation depends on what metadata the `@q-sys/qrwc` library provides. If the library doesn't expose component types and properties, this may require:
1. Extending the official client to fetch additional metadata
2. Maintaining a component type mapping
3. Making additional API calls to get component details

## Benefits
- Full API specification compliance
- Clients can identify component types and capabilities
- Enables property-based component filtering
- Better integration with Q-SYS Designer scripts

## Test Requirements
1. Verify all component types are correctly identified
2. Test that properties array is populated when available
3. Ensure backward compatibility (existing code still works)
4. Test with various component types (mixers, delays, processors)
5. Verify response format matches API specification exactly
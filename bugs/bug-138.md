# BUG-138: Configuration Sprawl and Direct Environment Access

**Status**: Open
**Severity**: Medium
**Priority**: P2 (Medium)
**Component**: Configuration
**Reported Date**: 2025-07-29
**Reporter**: Gemini
**Assignee**: Unassigned

## Summary

While a `ConfigManager` exists, multiple parts of the application still access configuration from different sources, including `process.env` and JSON files, directly. This violates the single source of truth principle and makes configuration management brittle and hard to test.

## Description

The goal of a centralized configuration manager is to provide a single, consistent interface for accessing all configuration values. However, several components bypass the `ConfigManager` and fetch values from `process.env` or other files directly. This leads to:

- **Inconsistent Configuration:** Different parts of the application may get the same configuration value from different sources, leading to subtle and hard-to-debug issues.
- **Difficult Testing:** Tests that need to mock configuration values have to mock `process.env` and potentially file system reads, which is more complex and less reliable than mocking a single configuration object.
- **Lack of Clarity:** It's not immediately clear where a given configuration value is coming from, making it hard to reason about the system's behavior.

## Steps to Reproduce

1.  Search the codebase for instances of `process.env` outside of `src/config/index.ts`.
2.  Observe that several files access environment variables directly.
3.  Note that some components also read from `qsys-core.config.json` directly.

## Expected Behavior

- All configuration values, without exception, are accessed through the `ConfigManager`.
- No part of the application, outside of the `ConfigManager` itself, should ever access `process.env` or read configuration files.
- Unit tests should be able to mock all configuration values by simply providing a mock `AppConfig` object.

## Actual Behavior

Configuration is scattered, making the system harder to manage and test.

## Proposed Solution

Strictly enforce the use of the `ConfigManager` as the single source of truth for all configuration.

1.  **Refactor All Direct Access:** Go through the codebase and replace every instance of `process.env` or direct file reads with a call to `configManager.getConfig()` or a specific getter like `getQSysConfig()`.

    **Before:**
    ```typescript
    // Some random file in the application
    const port = process.env.PORT || 3000;
    ```

    **After:**
    ```typescript
    // Some random file in the application
    import { getAPIConfig } from '../../config';
    const port = getAPIConfig().port;
    ```

2.  **Enhance the `ConfigManager`:** If any required configuration values are not currently exposed by the `ConfigManager`, add them. The `ConfigManager` should be the *only* module that knows about `.env` files, `qsys-core.config.json`, or any other configuration source.

## Test Cases

- [ ] A global search for `process.env` should only return results within `src/config/index.ts`.
- [ ] All unit tests that previously mocked `process.env` should be refactored to mock the `ConfigManager` instead.
- [ ] The application should be fully functional with all configuration flowing through the `ConfigManager`.

## Related Issues

- **Related to:** BUG-137

## Acceptance Criteria

- [ ] No direct access to `process.env` outside of the `ConfigManager`.
- [ ] No direct file reads for configuration outside of the `ConfigManager`.
- [ ] All configuration is provided to the application through the `ConfigManager`.

---

**Labels**: bug, technical-debt, configuration
**Milestone**: Core Refactoring
